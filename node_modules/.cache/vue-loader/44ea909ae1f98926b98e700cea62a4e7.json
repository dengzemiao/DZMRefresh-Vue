{"remainingRequest":"/Users/dengzemiao/Desktop/GitHub/DZMRefresh-Vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/dengzemiao/Desktop/GitHub/DZMRefresh-Vue/src/components/Refresh.vue?vue&type=style&index=0&id=432cdf5b&scoped=true&lang=css&","dependencies":[{"path":"/Users/dengzemiao/Desktop/GitHub/DZMRefresh-Vue/src/components/Refresh.vue","mtime":1640749638623},{"path":"/Users/dengzemiao/Desktop/GitHub/DZMRefresh-Vue/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/dengzemiao/Desktop/GitHub/DZMRefresh-Vue/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/dengzemiao/Desktop/GitHub/DZMRefresh-Vue/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/dengzemiao/Desktop/GitHub/DZMRefresh-Vue/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/dengzemiao/Desktop/GitHub/DZMRefresh-Vue/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLnJlZnJlc2gtdmlldyB7CiAgd2lkdGg6IDEwMCU7CiAgaGVpZ2h0OiAxMDAlOwogIG92ZXJmbG93LXk6IGF1dG87Cn0KLnJlZnJlc2gtZm9vdGVyIHsKICB3aWR0aDogMTAwJTsKfQouZm9vdGVyLWNvbnRlbnQgewogIGRpc3BsYXk6IGZsZXg7CiAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICBjb2xvcjogcmdiYSgwLDAsMCwuNjUpOwogIGZvbnQtc2l6ZTogMTRweDsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IDQ4cHg7Cn0K"},{"version":3,"sources":["Refresh.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Refresh.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <!-- 容器 -->\n  <div\n    class=\"refresh-view\"\n    ref=\"refresh-view\"\n    @mousewheel=\"scrollChange\"\n  >\n    <!-- 内容 -->\n    <slot></slot>\n    <!-- 尾部 -->\n    <div\n      class=\"refresh-footer\"\n      ref=\"refresh-footer\"\n    >\n      <!-- 可自定义尾部 -->\n      <slot\n        name=\"footer\"\n        :isMoreData=\"isMoreData\"\n        :isLoading=\"isLoading\"\n        :footerStyle=\"footerStyle\"\n        :nodata=\"nodata\"\n      >\n        <!-- 默认尾部元素 -->\n        <div\n          class=\"footer-content\"\n          :style=\"footerStyle\"\n        >\n          <!-- 加载中... -->\n          <slot name=\"loading\" v-if=\"isMoreData\">加载中...</slot>\n          <!-- 没有数据 -->\n          <slot name=\"nodata\" v-else>{{ nodata }}</slot>\n        </div>\n      </slot>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    // 是否有更多数据，没有更多数据则显示 '没有数据' 元素，并不会再调用加载回调\n    isMoreData: {\n      type: Boolean,\n      default: true\n    },\n    // 加载状态，设置为加载中，则不会重复触发加载事件\n    isLoading: {\n      type: Boolean,\n      default: false\n    },\n    // 是否在加载完成时，检查当前 footer 元素是否在进入加载范围\n    // isLoading 设置状态需要放在 isMoreData 设置状态之后，因为需要优先判断是否有数据\n    isLoadingWatch: {\n      type: Boolean,\n      default: true\n    },\n    // 是否监听窗口变化，有变化则检查是否进入加载范围\n    isOnResize: {\n      type: Boolean,\n      default: false\n    },\n    // 没有数据提示\n    nodata: {\n      type: String,\n      default: '没有更多数据了'\n    },\n    // 尾部显示多少比例，则可以进入加载，最大 1\n    footerScale: {\n      type: Number,\n      default: 0.3\n    },\n    // 尾部样式\n    footerStyle: {\n      type: Object,\n      default: () => { return new Object() }\n    }\n  },\n  watch: {\n    // 监听加载状态\n    isLoading: {\n      handler (newData) {\n      // 是否允许检查当前 footer 在进入加载范围内\n      // 注意：如果 refresh-view 元素有设置 padding-bottom 值，进入加载范围需要超出 padding-bottom 值，鼠标审查元素移到元素身上，则可以看到 footer 元素是否已经滚到 padding-bottom 值之上了。\n      console.log(this.isLoadingWatch);\n      if (this.isLoadingWatch) {\n          // 为 false 时则算加载完成\n          if (!newData) {\n            // 延迟调用\n            this.$nextTick(() => {\n              // 手动触发滚动\n              this.scrollChange()\n            })\n          }\n        }\n      }\n    }\n  },\n  mounted () {\n    // 获取滚动元素\n    const scrollview = this.$refs['refresh-view']\n    // 添加拖拽滚动条监听\n    scrollview.addEventListener('scroll', this.scrollChange, true)\n    // 监听窗口变化\n    if (this.isOnResize) { window.addEventListener('resize', this.onResize) }\n  },\n  // beforeDestroy 与 destroyed 里面移除都行\n  beforeDestroy () {\n    // 获取指定元素\n    const scrollview = this.$refs['refresh-view']\n    // 移除监听\n    scrollview.removeEventListener('scroll', this.scrollChange, true)\n    // 移除窗口监听\n    if (this.isOnResize) { window.removeEventListener('resize', this.onResize) }\n  },\n  methods: {\n    // 窗口变化\n    onResize () {\n      // 手动触发滚动\n      this.scrollChange()\n    },\n    // 滚动监听\n    scrollChange () {\n      // 有数据 && 没有在加载\n      if (this.isMoreData && !this.isLoading) {\n        // 获取容器对象\n        const refreshView = this.$refs['refresh-view']\n        const footerView = this.$refs['refresh-footer']\n        // 获取容器高度\n        const clientHeight = refreshView.clientHeight\n        // 获取容器滚动高度\n        const scrollHeight = refreshView.scrollHeight\n        // 当前滚动容器顶上坐标位置\n        const miny = refreshView.scrollTop\n        // 当前滚动容器底部坐标位置\n        const maxy = miny + clientHeight\n        // 底部高度\n        const footerHeight = footerView.clientHeight\n        // 底部不可见高度\n        const footerHideHeight = (1 - Math.min(1, this.footerScale)) * footerHeight\n        // 进入加载的最大坐标位置，多减少个 1px ，便于不相等\n        const loadingy = scrollHeight - footerHideHeight - 1\n        // 是否进入加载范围\n        if (maxy >= loadingy) {\n          // 进入加载\n          this.$emit('loading')\n        }\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.refresh-view {\n  width: 100%;\n  height: 100%;\n  overflow-y: auto;\n}\n.refresh-footer {\n  width: 100%;\n}\n.footer-content {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: rgba(0,0,0,.65);\n  font-size: 14px;\n  width: 100%;\n  height: 48px;\n}\n</style>"]}]}